<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>9th Kyu Quiz ‚Äî DojoFun</title>
<style>
  :root{
    --blue:#57aac8; --dark:#1C1C1C; --orange:#ff8317; --cream:#fff8ee;
    --green:#70b548; --grayL:#EBEBEB; --grayM:#666666; --white:#FFFFFF;

    --bg:var(--cream); --card:var(--white); --text:var(--dark); --muted:var(--grayM);
    --accent:#ff8317; --accent-2:var(--blue); --good:#16a34a; --bad:#dc2626;

    --belt-white:#ffffff; --belt-yellow:#ffe44d; --belt-orange:#ffa24d; --belt-green:#52d17f;
    --radius:18px;
  }
  *{box-sizing:border-box}
  body{margin:0;padding:24px;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  .container{max-width:1100px;margin:0 auto}

  /* Header */
  .pagehead{margin-bottom:10px}
  .titleRow{display:flex;align-items:center;gap:8px}
  .titles h1{margin:0 0 4px 0;font-size:28px;line-height:1.2}
  .subtitle{margin:0;color:var(--muted)}
  .emojiInline{font-size:28px;line-height:1}

  .backrow{margin:10px 0 0 0}
  .btn{padding:9px 12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-size:14px}
  .btn.orange{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.small{padding:7px 10px;font-size:13px;border-radius:10px}
  .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
  .btn.ghost{background:transparent}

  /* Belt frame around the game (not highscores) */
  .beltFrame{border-radius:24px;padding:12px;margin:12px 0 18px}
  .belt-9{border:6px solid #fff; box-shadow:0 0 0 10px #f7d633 inset;}

  /* Panels inside frame */
  .panel{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 12px 28px rgba(0,0,0,.08);margin-top:12px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .field{display:grid;gap:6px}
  .field label{font-size:12px;color:var(--muted)}
  .field input{padding:10px 12px;border-radius:12px;border:1px solid #e5e7eb;font-size:16px}

  /* Toggles left, side by side */
  .controls{display:flex;gap:18px;flex-wrap:wrap;align-items:center;margin-top:10px}
  .controls label{display:inline-flex;align-items:center;gap:8px;font-size:14px;color:var(--muted)}

  /* Two-column area */
  .quizcard{margin-top:16px;display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
  @media (max-width:820px){.quizcard{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 12px 28px rgba(0,0,0,.08)}
  #question{font-size:22px;margin:4px 0 12px}
  #answer{width:100%;font-size:20px;padding:12px 14px;border-radius:12px;border:1px solid #e5e7eb;outline:none}
  #answer:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(255,131,23,.18)}
  #answer.correct{border-color:var(--good)} #answer.wrong{border-color:var(--bad)}
  .choices{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin:8px 0}
  .choice{border:1px solid #e5e7eb;border-radius:12px;padding:12px;font-size:18px;background:#fff;cursor:pointer}
  .choice:hover{border-color:var(--accent);transform:translateY(-1px)}
  .buttons{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  #feedback{min-height:24px;margin-top:10px;font-weight:700}
  .scorebar{margin-top:14px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;font-size:14px;color:var(--muted)}
  .scorebar strong{color:var(--text)}
  .hidden{display:none!important}

  /* Progress card */
  .beltbar{display:grid;gap:12px}
  .belt-row{display:flex;align-items:center;gap:12px}
  .beltprogress{height:10px;background:#f1f5f9;border-radius:999px;overflow:hidden}
  .beltprogress>div{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%;transition:width .35s}
  .progress-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .tiny-img{display:flex;flex-direction:column;align-items:center;gap:6px}
  .tiny-img img{width:72px;height:72px;border-radius:50%;background:#fff;border:1px solid #eee;object-fit:cover}

  /* Confetti */
  #confetti{position:fixed;inset:0;width:100%;height:100%;pointer-events:none;z-index:9999}
  /* Hide editor help */
  #editorHelp{display:none}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="container">
  <!-- Title with inline emoji at the end -->
  <div class="pagehead">
    <div class="titleRow">
      <div class="titles">
        <h1>9th Kyu ‚Äî White + Yellow Stripe <span class="emojiInline" aria-hidden="true">ü•ã</span></h1>
        <p class="subtitle">Japanese ‚Üî English karate terms practice.</p>
      </div>
    </div>
    <div class="backrow">
      <button onclick="location.href='../'" class="btn small orange">‚¨ÖÔ∏è Back to Karate Hub</button>
    </div>
  </div>

  <!-- BELT FRAME start -->
  <div class="beltFrame belt-9">
    <!-- Profile / Toggles -->
    <div class="panel" id="profilePanel">
      <div class="row">
        <div class="field">
          <label for="nameInput">Player name</label>
          <input id="nameInput" placeholder="Enter your name"/>
        </div>
        <div class="field" style="align-self:end">
          <button id="saveProfileBtn" class="btn">Save profile</button>
        </div>
      </div>
      <div class="controls">
        <label><input type="checkbox" id="reverseToggle"/> Reverse: English ‚Üí Japanese</label>
        <label><input type="checkbox" id="hardModeToggle"/> Hard mode ü§Ø (type answers)</label>
      </div>
    </div>

    <!-- Quiz + Progress -->
    <div class="quizcard">
      <div class="card">
        <div id="question">Loading‚Ä¶</div>
        <div id="choices" class="choices"></div>
        <input id="answer" type="text" placeholder="Type answer here (English or Japanese)"/>
        <div class="buttons">
          <button id="checkBtn" class="btn primary">Check</button>
          <button id="hintBtn" class="btn">Hint</button>
          <button id="nextBtn" class="btn hidden">Next</button>
        </div>
        <div id="feedback"></div>
        <div class="scorebar">
          <div>Correct: <strong id="correct">0</strong> / <strong id="asked">0</strong></div>
          <div>Streak: <strong id="streak">0</strong> ¬∑ Best: <strong id="best">0</strong></div>
          <button id="resetBtn" class="btn" title="Reset your score & best">Reset Score</button>
          <button id="saveHighBtn" class="btn">Save Highscore</button>
        </div>
        <div class="shareRow" style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <input id="shareText" readonly style="flex:1 1 260px;padding:10px 12px;border-radius:12px;border:1px solid #e5e7eb"/>
          <button id="copyShare" class="btn">Copy</button>
          <button id="nativeShare" class="btn">Share</button>
        </div>
      </div>

      <div class="card">
        <div class="beltbar">
          <div class="progress-top">
            <div style="font-weight:700">9th Kyu progress</div>
            <div class="tiny-img">
              <img src="../images/white-yellow-belt.png" alt="White-yellow belt character" onerror="this.style.display='none'">
              <div style="font-size:12px;color:var(--muted)">White-Yellow Belt</div>
            </div>
          </div>
          <div class="belt-row">
            <div style="width:18px;height:18px;border-radius:4px;background:linear-gradient(90deg,var(--belt-white) 65%,var(--belt-yellow) 35%)"></div>
            <div style="flex:1">
              <div class="beltprogress"><div id="beltProg"></div></div>
            </div>
          </div>
          <div style="font-size:13px;color:var(--muted)">
            FYI: Typical requirement ‚Äî ~10 classes & 100% curriculum (tracked by your dojo, not here).
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- BELT FRAME end -->

  <!-- High scores lives OUTSIDE the frame -->
  <div class="panel" style="overflow:auto">
    <h3 style="margin:0 0 8px">High scores (device)</h3>
    <table id="highs" style="width:100%;border-collapse:collapse">
      <thead><tr><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Player</th><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Best Streak</th></tr></thead>
      <tbody id="highsBody"></tbody>
    </table>
  </div>

  <!-- Hidden helper retained -->
  <div class="panel" id="editorHelp"><details open><summary>How to edit</summary></details></div>
</div>

<script>
  // Terms (sample)
  const TERMS_EASY = [
    { en:"Bow", ja:"Rei" },
    { en:"Attention stance", ja:"Heisoku Dachi" },
    { en:"Ready stance", ja:"Musubi Dachi" },
    { en:"Make a fist", ja:"Seiken" },
    { en:"Straight punch", ja:"Choku Zuki" },
    { en:"Rising block", ja:"Age Uke" },
    { en:"Front kick", ja:"Mae Geri" },
    { en:"On guard position", ja:"Kamae" },
    { en:"Jab", ja:"Kizami Zuki" },
    { en:"Reverse punch", ja:"Gyaku Zuki" }
  ];
  const TERMS_MEDIUM=[]; const TERMS_HARD=[]; const TERMS_SUPER=[];
  const TERM_IMAGES={};

  const $=id=>document.getElementById(id);
  const profile=JSON.parse(localStorage.getItem('profile')||'{}');
  const stats=JSON.parse(localStorage.getItem('stats-9')||'{"asked":0,"correct":0,"streak":0,"best":0}');
  const highs=JSON.parse(localStorage.getItem('highs')||'[]');
  let current=null, reverse=false, multipleChoice=true;

  const normalize=s=>(s||'').toLowerCase().replace(/[\s\-']/g,'').normalize('NFKD').replace(/[\u0300-\u036f]/g,'');
  const currentPlayerName=()=> ( ($('nameInput').value||'').trim() ) || profile.name || 'Player';

  function poolFor(st){ if(st<3)return TERMS_EASY.length?TERMS_EASY:[]; if(st<7)return TERMS_MEDIUM.length?TERMS_MEDIUM:TERMS_EASY; if(st<12)return TERMS_HARD.length?TERMS_HARD:TERMS_MEDIUM.concat(TERMS_EASY); return TERMS_SUPER.length?TERMS_SUPER:TERMS_HARD.concat(TERMS_MEDIUM,TERMS_EASY); }
  function pickQuestion(){ const p=poolFor(stats.streak); current=p[Math.floor(Math.random()*p.length)]; renderQuestion(); }

  function renderQuestion(){
    $('nextBtn').classList.add('hidden'); $('feedback').textContent=''; $('answer').value=''; $('answer').classList.remove('correct','wrong');
    multipleChoice=!$('hardModeToggle').checked;
    const enToJa=$('reverseToggle').checked; reverse=!enToJa; // default Ja->En
    $('question').textContent = reverse ? `What is "${current.ja}" in English?` : `What is "${current.en}" in Japanese?`;

    const choices=$('choices'); choices.innerHTML='';
    if(multipleChoice){
      $('answer').style.display='none'; $('checkBtn').style.display='none'; $('hintBtn').style.display='none';
      const correct = reverse? current.en:current.ja;
      const opts=new Set([correct]);
      while(opts.size<4){ const r=poolFor(stats.streak)[Math.floor(Math.random()*poolFor(stats.streak).length)]; opts.add(reverse? r.en:r.ja); }
      Array.from(opts).sort(()=>Math.random()-0.5).forEach(opt=>{
        const b=document.createElement('button'); b.className='choice'; b.textContent=opt; b.onclick=()=>checkAnswer(opt); choices.appendChild(b);
      });
    }else{
      $('answer').style.display=''; $('checkBtn').style.display=''; $('hintBtn').style.display=''; $('answer').focus();
    }
  }

  // Confetti (hi-DPI)
  function confettiBurst(){
    const c=$('confetti'), ctx=c.getContext('2d'); const dpr=Math.max(1,devicePixelRatio||1);
    c.width=innerWidth*dpr; c.height=innerHeight*dpr; ctx.setTransform(dpr,0,0,dpr,0,0);
    const pcs=Array.from({length:140},()=>({x:Math.random()*innerWidth,y:-20-Math.random()*40,r:2+Math.random()*3,s:2+Math.random()*3,clr:`hsl(${Math.floor(Math.random()*360)},90%,60%)`,a:Math.random()*Math.PI}));
    let t=0; (function anim(){ ctx.clearRect(0,0,innerWidth,innerHeight); pcs.forEach(p=>{p.y+=p.s;p.x+=Math.sin((t/10)+p.a); ctx.fillStyle=p.clr; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();}); t++; if(t<70) requestAnimationFrame(anim); else ctx.clearRect(0,0,innerWidth,innerHeight); })();
  }

  function hint(){ const correct=reverse? current.en:current.ja; $('feedback').textContent=`Hint: ${correct[0]}‚Ä¶`; }
  function checkAnswer(manual){
    const input=manual ?? $('answer').value;
    const correct=reverse? current.en:current.ja;
    const ok=normalize(input)===normalize(correct);
    stats.asked++;
    if(ok){
      stats.correct++; stats.streak++; stats.best=Math.max(stats.best,stats.streak);
      $('feedback').textContent=`‚úÖ Correct, ${currentPlayerName()}!`; confettiBurst();
      saveStats(); updateScore(); setTimeout(pickQuestion,700); return;
    }
    stats.streak=0;
    $('feedback').textContent=`‚ùå Not quite. Answer: ${correct}`;
    saveStats(); updateScore(); $('nextBtn').classList.remove('hidden');
  }

  function saveStats(){ localStorage.setItem('stats-9', JSON.stringify(stats)); }
  function updateScore(){ $('correct').textContent=stats.correct; $('asked').textContent=stats.asked; $('streak').textContent=stats.streak; $('best').textContent=stats.best; $('beltProg').style.width=Math.min(100,Math.round((stats.streak/10)*100))+'%'; $('shareText').value=`9th Kyu ‚Äî Best streak ${stats.best}. Try it: ${location.href}`; }

  function renderHighs(){ const tb=$('highsBody'); tb.innerHTML=''; highs.forEach(h=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td style="padding:8px;border-bottom:1px solid #e5e7eb">${h.name}</td><td style="padding:8px;border-bottom:1px solid #e5e7eb">${h.best}</td>`; tb.appendChild(tr); }); }
  function saveHighscore(){ highs.push({name:currentPlayerName(),best:stats.best,t:Date.now()}); highs.sort((a,b)=>b.best-a.best); localStorage.setItem('highs', JSON.stringify(highs)); renderHighs(); }

  function hydrateProfile(){ $('nameInput').value = profile.name || ''; }
  function saveProfile(){ const name=($('nameInput').value||'').trim(); localStorage.setItem('profile', JSON.stringify({name})); }

  $('checkBtn').onclick=()=>checkAnswer();
  $('hintBtn').onclick=hint;
  $('nextBtn').onclick=pickQuestion;
  $('resetBtn').onclick=()=>{ stats.asked=0; stats.correct=0; stats.streak=0; stats.best=0; updateScore(); saveStats(); };
  $('hardModeToggle').onchange=renderQuestion;
  $('reverseToggle').onchange=renderQuestion;
  $('saveProfileBtn').onclick=()=>{ saveProfile(); alert('Profile saved!'); };
  $('saveHighBtn').onclick=saveHighscore;
  $('copyShare').onclick=async()=>{ try{ await navigator.clipboard.writeText($('shareText').value); alert('Copied!'); }catch(e){ alert('Copy failed'); } };
  $('nativeShare').onclick=async()=>{ if(navigator.share){ try{ await navigator.share({ text:$('shareText').value }); }catch(e){} } };

  hydrateProfile(); renderHighs(); updateScore();
  $('hardModeToggle').checked=false; $('reverseToggle').checked=false;
  pickQuestion();
</script>
</body>
</html>